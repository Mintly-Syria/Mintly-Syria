<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mintly محول العملات السوري</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-body: #0f0f0f;
            --bg-card: #1a1a1a;
            --bg-input: #252525;
            --text-main: #ffd700; 
            --text-muted: #b0b0b0;
            --border: #333;
            --accent: #ffb700;
            --accent-glow: rgba(255, 183, 0, 0.15);
            --radius: 18px;
            --result-color: #ffd700;
            --font-numbers: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Cairo', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-body);
            background-image: radial-gradient(circle at 50% -20%, #2a2a00 0%, transparent 60%);
            color: var(--text-main);
            height: 100dvh; 
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .app-container {
            width: 100%;
            max-width: 480px;
            height: 100%; 
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 35px 20px 20px 20px; 
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.7);
            position: relative;
            display: flex;
            flex-direction: column; 
            justify-content: space-between;
        }

        .brand-logo {
            position: absolute;
            top: 15px;
            left: 15px; 
            width: 40px; 
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent);
            box-shadow: 0 0 15px rgba(255, 183, 0, 0.2);
            background-color: #000;
            z-index: 10;
        }

        h1 {
            text-align: center;
            font-weight: 900;
            font-size: 1.6rem; 
            margin-bottom: 0px; 
            margin-top: 10px;
            color: var(--text-main);
            text-shadow: 0 0 15px var(--accent-glow);
            letter-spacing: -0.5px;
            flex-shrink: 0;
        }

        h2 {
            text-align: center;
            font-weight: 300;
            font-size: 1rem;
            margin-bottom: 15px; 
            color: var(--text-muted);
            letter-spacing: 1px;
            text-transform: uppercase;
            flex-shrink: 0;
        }

        .content-wrapper {
            flex: 1; 
            display: flex;
            flex-direction: column;
            justify-content: center; 
            overflow-y: hidden; 
        }

        .input-group {
            margin-bottom: 10px; 
            position: relative;
        }

        label {
            display: block;
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-bottom: 4px;
            font-weight: 600;
            padding-right: 5px;
        }

        .styled-input {
            width: 100%;
            background: var(--bg-input);
            border: 2px solid var(--border);
            color: var(--text-main);
            padding: 10px 15px; 
            border-radius: var(--radius);
            font-size: 1.3rem;
            font-weight: 700;
            font-family: var(--font-numbers);
            direction: ltr;
            text-align: right;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .styled-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .custom-select-wrapper {
            position: relative;
            user-select: none;
            width: 100%;
            z-index: 100;
        }

        .custom-select {
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .custom-select__trigger {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px; 
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-main);
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s;
        }

        .custom-select__trigger:hover {
            border-color: #555;
        }

        .custom-select.open .custom-select__trigger {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .arrow {
            font-size: 0.7rem;
            color: var(--text-muted);
            transition: transform 0.3s;
        }

        .custom-select.open .arrow {
            transform: rotate(180deg);
        }

        .custom-options {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%;
            max-width: 450px;
            max-height: 80vh;
            background: var(--bg-card);
            border: 2px solid var(--accent);
            border-radius: 20px;
            box-shadow: 0 0 0 1000px rgba(0,0,0,0.8);
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
            overflow-y: auto;
            z-index: 99999;
            display: flex;
            flex-direction: column;
            padding-bottom: 10px;
        }

        .custom-select.open .custom-options {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            visibility: visible;
            pointer-events: all;
        }

        .custom-options::-webkit-scrollbar { width: 8px; }
        .custom-options::-webkit-scrollbar-track { background: var(--bg-input); }
        .custom-options::-webkit-scrollbar-thumb { background-color: var(--accent); border-radius: 4px; }

        /* تنسيق شريط البحث */
        .currency-search-container {
            padding: 10px 15px;
            background: var(--bg-card);
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 1px solid var(--border);
        }

        .currency-search {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-family: 'Cairo', sans-serif;
            outline: none;
            transition: 0.3s;
        }

        .currency-search:focus {
            border-color: var(--accent);
        }

        .custom-option {
            position: relative;
            display: flex;
            align-items: center;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .custom-option:last-child { border-bottom: none; }

        .custom-option:hover {
            background-color: rgba(255, 183, 0, 0.1);
            color: var(--text-main);
            padding-right: 25px;
        }

        .custom-option.selected {
            color: var(--accent);
            background-color: rgba(255, 183, 0, 0.15);
        }

        .flag-icon {
            width: 32px;
            height: 24px;
            object-fit: contain; 
            border-radius: 4px;
            margin-left: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            background-color: #333;
        }

        .currency-text {
            flex: 1;
            text-align: right;
            direction: ltr;
        }
        
        .ar-name {
            display: block;
            color: var(--text-muted);
            font-size: 0.8em;
            margin-top: 3px;
            direction: rtl; 
            text-align: right;
        }

        .swap-row {
            display: flex;
            justify-content: center;
            margin: -5px 0 10px 0; 
            position: relative;
            z-index: 1;
        }

        .btn-swap {
            width: 40px;
            height: 40px; 
            border-radius: 50%;
            background: var(--bg-card);
            border: 2px solid var(--border);
            color: var(--text-muted);
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .btn-swap:hover {
            color: var(--accent);
            border-color: var(--accent);
            transform: rotate(180deg) scale(1.1);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .btn-convert {
            width: 100%;
            padding: 12px; 
            background: linear-gradient(135deg, var(--accent), #d97706);
            color: #000;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 800;
            cursor: pointer;
            margin-top: 5px;
            box-shadow: 0 5px 15px -5px rgba(255, 183, 0, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            flex-shrink: 0;
        }

        .btn-convert:active {
            transform: scale(0.98);
        }

        .result-box {
            margin-top: 10px; 
            padding-top: 15px;
            border-top: 1px solid var(--border);
            text-align: center;
            opacity: 0;
            transform: translateY(15px);
            transition: all 0.5s;
            flex-shrink: 0;
        }

        .result-box.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-amount {
            font-size: 2.2rem; 
            font-weight: 900;
            color: var(--result-color);
            line-height: 1.1;
            margin-bottom: 2px;
            text-shadow: 0 0 20px var(--accent-glow);
            font-family: var(--font-numbers);
            word-break: break-all;
        }

        .rate-display {
            font-size: 0.8rem;
            color: var(--text-muted);
            background: var(--bg-input);
            padding: 4px 12px;
            border-radius: 50px;
            border: 1px solid var(--border);
            display: inline-block;
            margin-top: 5px;
        }

        .loader {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,0.3);
            border-radius: 50%;
            border-top-color: #000;
            animation: spin 0.8s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-card);
            color: var(--text-main);
            border: 1px solid var(--accent);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 700;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            transition: 0.4s;
            z-index: 100000;
            font-size: 0.85rem;
        }
        .toast.active { transform: translateX(-50%) translateY(0); }

        .close-modal {
            text-align: center;
            padding: 15px;
            color: var(--accent);
            font-size: 1.2rem;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            margin-bottom: 0px;
            flex-shrink: 0;
        }
        .close-modal:active {
            opacity: 0.7;
        }

    </style>
</head>
<body>

    <div class="app-container">
        <img src="https://i.postimg.cc/zf3hy2pW/images-(1).jpg" class="brand-logo" alt="Mintly Logo">

        <div style="flex-shrink: 0;">
            <h1>Mintly-Syria</h1>
            <h2>محول العملات السوري</h2>
        </div>

        <div class="content-wrapper">
            <div class="input-group">
                <label>المبلغ (Amount)</label>
                <input type="number" id="amount" class="styled-input" value="1" placeholder="0.00" lang="en">
            </div>

            <div class="input-group">
                <label>من (From)</label>
                <div class="custom-select-wrapper">
                    <div class="custom-select" id="fromSelect">
                        <div class="custom-select__trigger">
                            <span>اختر العملة</span>
                            <span class="arrow">▼</span>
                        </div>
                        <div class="custom-options"></div>
                    </div>
                </div>
            </div>

            <div class="swap-row">
                <button class="btn-swap" id="swapBtn">⇄</button>
            </div>

            <div class="input-group">
                <label>إلى (To)</label>
                <div class="custom-select-wrapper">
                    <div class="custom-select" id="toSelect">
                        <div class="custom-select__trigger">
                            <span>اختر العملة</span>
                            <span class="arrow">▼</span>
                        </div>
                        <div class="custom-options"></div>
                    </div>
                </div>
            </div>
        </div>

        <div style="flex-shrink: 0;">
            <button class="btn-convert" id="convertBtn">
                <span class="btn-text">Convert Now</span>
                <div class="loader" id="loader"></div>
            </button>

            <div class="result-box" id="resultBox">
                <div class="result-amount" id="resultAmount" lang="en">0.00</div>
                <div class="rate-display" id="rateDisplay" lang="en">1 USD = --- USD</div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">Error Message</div>

    <script>
        const API_BASE = "https://open.er-api.com/v6/latest/";

        // تغيير العملات الافتراضية
        let selectedFrom = 'USD';
        let selectedTo = 'SYP';

        const amountInput = document.getElementById('amount');
        const convertBtn = document.getElementById('convertBtn');
        const swapBtn = document.getElementById('swapBtn');
        const loader = document.getElementById('loader');
        const btnText = document.querySelector('.btn-text');
        const resultBox = document.getElementById('resultBox');
        const resultAmount = document.getElementById('resultAmount');
        const rateDisplay = document.getElementById('rateDisplay');
        const toast = document.getElementById('toast');

        const arabicNames = {
            AED: "درهم إماراتي", AFN: "أفغاني", ALL: "ليك ألباني", AMD: "درام أرميني", ANG: "جيلدر هولندي", AOA: "كوانزا أنغولي", ARS: "بيزو أرجنتيني", AUD: "دولار أسترالي", AWG: "جيلدر أروبي", AZN: "مانات أذربيجاني",
            BAM: "مارك قابل للتحويل", BBD: "دولار بربادوسي", BDT: "تاكا بنغلاديشي", BGN: "ليف بلغاري", BHD: "دينار بحريني", BIF: "فرنك بروندي", BMD: "دولار برمودي", BND: "دولار بروني", BOB: "بوليفيانو", BRL: "ريال برازيلي", BSD: "دولار بهامي", BTC: "بيتكوين", BTN: "نغلتروم بوتاني", BWP: "بولا بوتسواني", BYN: "روبل بلاروسي", BZD: "دولار بليزي",
            CAD: "دولار كندي", CDF: "فرنك كونغولي", CHF: "فرنك سويسري", CLP: "بيزو تشيلي", CNY: "يوان صيني", COP: "بيزو كولومبي", CRC: "كولون كوستاريكي", CUC: "بيزو كوبي قابل للتحويل", CUP: "بيزو كوبي", CVE: "إسكودو رأس أخضري", CZK: "كورونا تشيكية",
            DJF: "فرنك جيبوتي", DKK: "كرونة دانمركية", DOP: "بيزو دومينيكي", DZD: "دينار جزائري",
            EGP: "جنيه مصري", ERN: "ناقفا إريتري", ETB: "بير إثيوبي", EUR: "يورو",
            FJD: "دولار فيجي", FKP: "جنيه جزر فوكلاند", GBP: "جنيه إسترليني", GEL: "لاري جورجي", GGP: "جنيه غرنزي", GHS: "سيدي غاني", GIP: "جنيه جبل طارق", GMD: "دالاسي غامبي", GNF: "فرنك غيني", GTQ: "كيتزال غواتيمالي", GYD: "دولار غيانا",
            HKD: "دولار هونغ كونغي", HNL: "لمبيرا هندوراسية", HRK: "كونا كرواتية", HTG: "غورد هايتي", HUF: "فورنت مجري",
            IDR: "روبية إندونيسية", IMP: "جنيه مان", INR: "روبية هندية", IQD: "دينار عراقي", IRR: "ريال إيراني", ISK: "كرونة آيسلندية", JEP: "جنيه جيرزي", JMD: "دولار جامايكي", JOD: "دينار أردني", JPY: "ين ياباني",
            KES: "شلن كيني", KGS: "سوم قرغيزستاني", KHR: "رييل كمبودي", KMF: "فرنك قمري", KPW: "وون كوري شمالي", KRW: "وون كوري جنوبي", KWD: "دينار كويتي", KYD: "دولار جزر كايمان", KZT: "تينغ كازاخستاني",
            LAK: "كيب لاوسي", LBP: "ليرة لبنانية", LKR: "روبية سريلانكية", LRD: "دولار ليبيري", LSL: "لوتي ليسوتو", LYD: "دينار ليبي",
            MAD: "درهم مغربي", MDL: "ليو مولدوفي", MGA: "أرياري مدغشقري", MKD: "دينار مقدوني", MMK: "كيات ميانماري", MNT: "توغريك منغولي", MOP: "باتاكا ماكاوي", MRU: "أوقية موريتانية", MUR: "روبية موريشيوسية", MVR: "روفيية مالديفية", MWK: "كواشا ملاوي", MXN: "بيزو مكسيكي", MYR: "رينغيت ماليزي", MZN: "ميتكال موزمبيقي",
            NAD: "دولار ناميبي", NGN: "نايرا نيجيري", NIO: "كوردوبا نيكاراغوا", NOK: "كرونة نرويجية", NPR: "روبية نيبالية", NZD: "دولار نيوزيلندي",
            OMR: "ريال عماني",
            PAB: "بالبوا بنمي", PEN: "سول بيروفي", PGK: "كينا بابوا غينيا جديدة", PHP: "بيزو فلبيني", PKR: "روبية باكستانية", PLN: "زلوتي بولندي", PYG: "غواراني باراغواي",
            QAR: "ريال قطري",
            RON: "ليو روماني", RSD: "دينار صربي", RUB: "روبل روسي", RWF: "فرنك رواندي",
            SAR: "ريال سعودي", SBD: "دولار جزر سليمان", SCR: "روبية سيشلية", SDG: "جنيه سوداني", SEK: "كرونة سويدية", SGD: "دولار سنغافوري", SHP: "جنيه سانت هيلين", SLL: "ليون سيراليون", SOS: "شلن صومالي", SPL: "لوبيغو", SRD: "دولار سورينامي", STN: "دوبرا ساو تومي", SVC: "كولون سلفادوري", SYP: "ليرة سورية", SZL: "ليلانجيني سوازي",
            THB: "بات تايلاندي", TJS: "سوموني طاجيكي", TMT: "منات تركمانستاني", TND: "دينار تونسي", TOP: "بانغا تونغي", TRY: "ليرة تركية", TTD: "دولار ترينيدادي", TVD: "دولار توفالو", TWD: "دولار تايواني جديد", TZS: "شلن تنزاني",
            UAH: "هريفنيا أوكرانية", UGX: "شلن أوغندي", USD: "دولار أمريكي", UYU: "بيزو أوروغواي", UZS: "سوم أوزبكستاني",
            VEF: "بوليفار فنزويلي", VND: "دونج فيتنامي", VUV: "فاتو فانواتو",
            WST: "تالا ساموا",
            XAF: "فرنك CFA وسط أفريقيا", XAG: "أونصة فضة", XAU: "أونصة ذهب", XBA: "وحدة مركبة أوروبية", XBB: "وحدة مالية أوروبية", XBC: "وحدة حسابية أوروبية (XBC)", XBD: "وحدة حسابية أوروبية (XBD)", XCD: "دولار شرق الكاريبي", XDR: "حقوق السحب الخاصة", XOF: "فرنك CFA غرب أفريقيا", XPD: "أونصة بالاديوم", XPF: "فرنك سي إف بي", XPT: "أونصة بلاتين", XSU: "سوكر", XTS: "رمز عملة للاختبار", XUA: "وحدة حسابية أديس أبابا", XXX: "عملة غير معروفة",
            YER: "ريال يمني",
            ZAR: "راند جنوب أفريقي", ZMW: "كواشا زامبي", ZWL: "دولار زيمبابوي"
        };

        document.addEventListener('DOMContentLoaded', async () => {
            let currencyList = {};
            
            try {
                const res = await fetch("https://open.er-api.com/v6/currencies");
                if (res.ok) {
                    const data = await res.json();
                    if (data.currencies) currencyList = data.currencies;
                    else throw new Error("No data");
                } else throw new Error("API Error");
            } catch (error) {
                console.warn("Using fallback for list...");
                try {
                    const resRates = await fetch(`${API_BASE}USD`);
                    if (resRates.ok) {
                        const dataRates = await resRates.json();
                        if (dataRates.rates) {
                            Object.keys(dataRates.rates).forEach(code => currencyList[code] = code);
                        }
                    }
                } catch (e) {
                    showToast("Failed to load currencies");
                    return;
                }
            }

            initCustomSelects(currencyList);
        });

        function initCustomSelects(currencies) {
            const codes = Object.keys(currencies).filter(code => code !== 'ILS').sort();
            
            const getIconUrl = (code) => {
                if (code === 'XAU') return 'https://cdn-icons-png.flaticon.com/512/6146/6146333.png';
                if (code === 'XAG') return 'https://cdn-icons-png.flaticon.com/512/6146/6146332.png';
                if (code === 'XPT') return 'https://cdn-icons-png.flaticon.com/512/2633/2633551.png';
                if (code === 'XPD') return 'https://cdn-icons-png.flaticon.com/512/2633/2633548.png';
                if (code === 'BTC') return 'https://cryptologos.cc/logos/bitcoin-btc-logo.png';
                if (code === 'ETH') return 'https://cryptologos.cc/logos/ethereum-eth-logo.png';
                if (code === 'XDR') return 'https://cdn-icons-png.flaticon.com/512/3550/3550317.png';
                if (code === 'XAF' || code === 'XOF' || code === 'XCD' || code === 'XPF') {
                    return 'https://cdn-icons-png.flaticon.com/512/2693/2693502.png';
                }
                if (code.startsWith('X') && code !== 'XXX') {
                     return 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';
                }
                const countryCode = code.substring(0, 2).toLowerCase();
                return `https://flagcdn.com/w40/${countryCode}.png`;
            };

            const createListHTML = () => {
                let closeBtn = `<div class="close-modal">✕ إغلاق</div>`;
                // إضافة حقل البحث
                let searchHTML = `
                <div class="currency-search-container">
                    <input type="text" class="currency-search" placeholder="بحث (اسم أو رمز)...">
                </div>`;
                
                let list = codes.map(code => {
                    const engName = currencies[code];
                    const araName = arabicNames[code] || engName;
                    const iconUrl = getIconUrl(code);
                    
                    return `
                        <span class="custom-option" data-value="${code}">
                            <img src="${iconUrl}" class="flag-icon">
                            <div class="currency-text">
                                <strong>${code}</strong> 
                                <span class="ar-name">${araName}</span>
                            </div>
                        </span>
                    `;
                }).join('');
                return closeBtn + searchHTML + list;
            };

            const listHTML = createListHTML();

            setupCustomSelect('fromSelect', listHTML, (val) => { selectedFrom = val; });
            setupCustomSelect('toSelect', listHTML, (val) => { selectedTo = val; });

            // تعيين القيم الافتراضية الجديدة
            selectOption('fromSelect', 'USD');
            selectOption('toSelect', 'SYP'); 
        }

        function setupCustomSelect(elementId, htmlContent, callback) {
            const wrapper = document.getElementById(elementId);
            const trigger = wrapper.querySelector('.custom-select__trigger span:first-child');
            const optionsContainer = wrapper.querySelector('.custom-options');
            
            optionsContainer.innerHTML = htmlContent;

            const closeModal = () => {
                wrapper.classList.remove('open');
                wrapper.parentElement.style.zIndex = 1;
            };

            const openModal = () => {
                wrapper.classList.add('open');
                wrapper.parentElement.style.zIndex = 1000;
                optionsContainer.scrollTop = 0;
                
                // تنظيف البحث عند الفتح
                const searchInput = optionsContainer.querySelector('.currency-search');
                if(searchInput) {
                    searchInput.value = '';
                    const options = optionsContainer.querySelectorAll('.custom-option');
                    options.forEach(opt => opt.style.display = 'flex');
                    searchInput.focus();
                }
            };

            wrapper.querySelector('.custom-select__trigger').addEventListener('click', function(e) {
                e.stopPropagation();
                document.querySelectorAll('.custom-select').forEach(el => {
                    if (el !== wrapper) {
                        el.classList.remove('open');
                        el.parentElement.style.zIndex = 1;
                    }
                });

                if (wrapper.classList.contains('open')) {
                    closeModal();
                } else {
                    openModal();
                }
            });

            wrapper.querySelector('.close-modal').addEventListener('click', closeModal);

            // منطق البحث
            const searchInput = optionsContainer.querySelector('.currency-search');
            if(searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const term = e.target.value.toLowerCase();
                    const options = optionsContainer.querySelectorAll('.custom-option');
                    
                    options.forEach(opt => {
                        const code = opt.dataset.value.toLowerCase();
                        const arName = opt.querySelector('.ar-name').textContent;
                        
                        // البحث في الرمز (إنجليزي) أو الاسم (عربي)
                        if (code.includes(term) || arName.includes(term)) {
                            opt.style.display = 'flex';
                        } else {
                            opt.style.display = 'none';
                        }
                    });
                });
            }

            wrapper.querySelectorAll('.custom-option').forEach(option => {
                option.addEventListener('click', function() {
                    const value = this.getAttribute('data-value');
                    const araName = this.querySelector('.ar-name').textContent;
                    const imgSrc = this.querySelector('img').src;

                    trigger.innerHTML = `
                        <div style="display:flex; align-items:center;">
                            <img src="${imgSrc}" class="flag-icon" style="width:18px; height:13px; margin-left:8px;">
                            ${value} - ${araName}
                        </div>
                    `;

                    callback(value);
                    closeModal();
                });
            });
        }

        function selectOption(elementId, code) {
            const wrapper = document.getElementById(elementId);
            const option = wrapper.querySelector(`.custom-option[data-value="${code}"]`);
            if (option) option.click();
        }

        window.addEventListener('click', function(e) {
            if (!e.target.closest('.custom-select')) {
                document.querySelectorAll('.custom-select').forEach(el => {
                    el.classList.remove('open');
                    el.parentElement.style.zIndex = 1;
                });
            }
        });

        async function performConvert() {
            const amount = parseFloat(amountInput.value);
            if (isNaN(amount) || amount <= 0) {
                showToast("Please enter a valid amount");
                return;
            }

            resultBox.classList.remove('show');
            setLoading(true);

            try {
                const response = await fetch(`${API_BASE}${selectedFrom}`);
                if (!response.ok) throw new Error("API Error");
                const data = await response.json();
                
                if (data.result === "success" && data.rates[selectedTo]) {
                    const rate = data.rates[selectedTo];
                    const total = amount * rate;
                    
                    setTimeout(() => {
                        animateResult(total, rate);
                        resultBox.classList.add('show');
                    }, 200);
                } else {
                    showToast("Currency not supported");
                }
            } catch (error) {
                console.error(error);
                showToast("Connection Error. Please try again.");
            } finally {
                setLoading(false);
            }
        }

        function animateResult(targetValue, rate) {
            const araTarget = arabicNames[selectedTo] || selectedTo;
            rateDisplay.textContent = `1 ${selectedFrom} = ${rate.toFixed(4)} ${selectedTo}`;
            
            const duration = 1500;
            const startValue = 0;
            const startTime = performance.now();

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const ease = 1 - Math.pow(1 - progress, 3);
                const currentVal = startValue + (targetValue - startValue) * ease;
                const formatted = new Intl.NumberFormat('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(currentVal);
                resultAmount.textContent = formatted;
                if (progress < 1) requestAnimationFrame(update);
            }
            requestAnimationFrame(update);
        }

        function setLoading(isLoading) {
            if (isLoading) {
                convertBtn.disabled = true;
                btnText.style.display = 'none';
                loader.style.display = 'block';
            } else {
                convertBtn.disabled = false;
                btnText.style.display = 'block';
                loader.style.display = 'none';
            }
        }

        function showToast(msg) {
            toast.textContent = msg;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        convertBtn.addEventListener('click', performConvert);
        amountInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performConvert();
        });

        swapBtn.addEventListener('click', () => {
            swapBtn.style.transform = "rotate(180deg) scale(1.1)";
            setTimeout(() => swapBtn.style.transform = "rotate(0deg) scale(1)", 300);
            const temp = selectedFrom;
            selectOption('fromSelect', selectedTo);
            selectOption('toSelect', temp);
            performConvert();
        });

    </script>
</body>
</html>
